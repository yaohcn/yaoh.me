---
title: "closure"
date: 2020-01-05T19:47:52+08:00
draft: false
---
## [Closure](https://en.wikipedia.org/wiki/Closure_(computer_programming))
闭包是由函数及其相关引用环境组合而成的实体，一般通过在匿名函数中引用外部函数的局部变量或包全局变量构成
> 闭包=函数+引用环境

闭包对闭包外的环境引入是直接引用，编译器检测到闭包，会将闭包引用的外部环境变量分配到堆上。  
闭包最初的目的是减少全局变量，在函数调用的过程中隐式的传递共享变量。  
对象是附有行为的数据，而闭包是附有数据的行为。

Go实现闭包是通过返回一个如下的结构来实现的
```go
type Closure struct {
	F uintptr
	env *Type
}
```
F是返回的匿名函数指针，env是对外部环境变量的引用集合。如果闭包内没有修改外部变量，  
则go编译器直接优化为值传递，反之则是通过指针传递的。

